s Reading Notes
## LSM trees
![[Pasted image 20240219121326.png]]
$$
\begin{array}{|l|l|l|}
\hline \text { Term } & \text { Description } & \text { Unit } \\
\hline N & \text { Total number of entries } & \text { entries } \\
\hline L & \text { Number of levels } & \text { levels } \\
\hline B & \text { Number of entries that fit into a disk page } & \text { entries } \\
\hline E & \text { Size of an entry } & \text { bits } \\
\hline P & \text { Size of the buffer in disk pages } & \text { pages } \\
\hline T & \text { Size ratio between adjacent levels } & \\
\hline T_{\text {lim }} & \text { Size ratio value at which point } L \text { converges to } 1 & \\
\hline M & \text { Total amount of main memory in system } & \text { bits } \\
\hline M_{\text {buffer }} & \text { Main memory allocated to the buffer } & \text { bits } \\
\hline M_{\text {filters }} & \text { Main memory allocated to the Bloom filters } & \text { bits } \\
\hline M_{\text {pointers }} & \text { Main memory allocated to the fence pointers } & \text { bits } \\
\hline
\end{array}
$$
$$
M_{\text {buffer }}=P \cdot B \cdot E,
$$

$$
L=\left\lceil\log _T\left(\frac{N \cdot E}{M_{\text {buffer }}} \cdot \frac{T-1}{T}\right)\right\rceil
$$

$$
T_{l i m}=\frac{N \cdot E}{M_{\text {buffer }}}
$$

*LSM-trees* store key-value pairs.++

![[Pasted image 20240219121212.png]]

# Slides notes
**LSM trees** and **Fibonacci Heaps**

## Trees
### Binary search trees
![[Pasted image 20240219151412.png]]
**Operations**:
- $\texttt{Tree-Insert(x)}$
- $\texttt{Tree-Delete(x)}$
- $\texttt{Tree-Search(x)}$

All operations take $O(h)$, where $h$ is the height $\lg\leq h < n$

### LSM-trees
**Basic idea**:
- Sorted lists $L_i$ for $i=0,1,2, \ldots$ 
- List $L_i$ contains 0 or $2^i$ elements
- Largest list contains $N\leq n$ elements

Array containing lists
![[Pasted image 20240219152157.png]]
$\texttt{search(x)}$ in lists takes: 
$$
\sum_{i=1}^{\lg N} \log \left(2^i\right)=\sum_{i=1}^{\lg N} i=O\left((\lg n)^2\right)
$$

Cost of $\texttt{merge}$ operation:
$$
\leq c \sum_{i=1}^j 2^i<c 2^{j+1}
$$



Elementer i $L_i$ har været del af $i$ merge operationer, koster $O(1) /$ element
Potentialfunktion: $\Phi(D)=2 c \sum_{i=0}^{\lg N}(\lg (N)-i)\left|L_i\right|$
Lad $L_0^{\prime}, L_1^{\prime}, \ldots$ være listerne efter indsættelse, der starter med $L_0, L_1, \ldots$
Hvis $j$ er den første tomme liste i $D$ har vi $\left|L_j^{\prime}\right|=2^j$ og $\left|L_j\right|=0$, dvs. amortiseret kompleksitet:
$$
\begin{aligned}
\hat{c}_t & =c_t+\Phi\left(D^{\prime}\right)-\Phi(D) \leq c 2^{j+1}+2 c \sum_{i=0}^j 2^i(\lg (N)-i)\left(\left|L_i^{\prime}\right|-\left|L_i\right|\right) \\
& =c \lg (N)+c 2^{j+1}-2 c \sum_{i=0}^j i\left(\left|L_i^{\prime}\right|-\left|L_i\right|\right) \\
& \leq c \lg (N)+c 2^{j+1}-c j 2^{j+1}+c(j-1) 2^{j+1}=c \lg (N) .
\end{aligned}
$$

## Priority queues
**Operations**:
$$
\begin{aligned}
\texttt{Make-Heap} \\
\texttt{Insert} \\
\texttt{Minimum} \\
\texttt{Extract-Min} \\
\texttt{Union} \\
\texttt{Decrease-key} \\
\texttt{Delete} \\
\end{aligned}
$$

### Binary heaps
![[Pasted image 20240219161428.png]]
**Invariants**
+ Tree is perfectly balanced
+ Nodes on the lowest level are shifted to the left
+ Values grow upwards to the root

Representation in memory
![[Pasted image 20240219161558.png]]

### Fibonacci heaps
$$
\begin{array}{|lcc|}
\hline \text { Procedure } & \begin{array}{c}
\text { Binary heap } \\
\text { (worst-case) }
\end{array} & \begin{array}{c}
\text { Fibonacci heap } \\
\text { (amortized) }
\end{array} \\
\hline \text { MAKE-HEAP } & \Theta(1) & \Theta(1) \\
\text { INSERT } & \Theta(\lg n) & \Theta(1) \\
\text { MINIMUM } & \Theta(1) & \Theta(1) \\
\text { EXTRACT-MIN } & \Theta(\lg n) & O(\lg n) \\
\text { UNION } & \Theta(n) & \Theta(1) \\
\text { DECREASE-KEY } & \Theta(\lg n) & \Theta(1) \\
\text { DELETE } & \Theta(\lg n) & O(\lg n) \\
\hline
\end{array}
$$
*Fibonacci* heaps consists of many interconnected *heaps*:
![[Pasted image 20240219162212.png]]
#### Consolidate
Before
![[Pasted image 20240219163724.png]]
After
![[Pasted image 20240219163709.png]]